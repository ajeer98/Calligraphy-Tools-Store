<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Calligraphy Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Product Admin Panel</h1>
            <div class="flex items-center gap-4">
                <button onclick="resetForm(); document.getElementById('title').focus();" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 font-medium text-sm">
                    <i class="fas fa-plus mr-2"></i>Add New Product
                </button>
                <button onclick="downloadJSON()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 font-medium text-sm">
                    <i class="fas fa-download mr-2"></i>Export JSON
                </button>
                <a href="index.html" class="text-blue-600 hover:underline">Back to Store</a>
            </div>
        </div>
        
        <!-- Add/Edit Form -->
        <form id="product-form" class="space-y-4 mb-8 border-b pb-8">
            <input type="hidden" id="product-id">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Title</label>
                    <input type="text" id="title" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Category (Tag)</label>
                    <select id="tag" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2">
                        <option value="Calligraphy Kit">Calligraphy Kit</option>
                        <option value="Qalam">Qalam</option>
                        <option value="Ink">Ink</option>
                        <option value="Ink container">Ink container</option>
                        <option value="Paper">Paper</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Price (₹)</label>
                    <input type="number" id="price" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">MRP (₹)</label>
                    <input type="number" id="mrp" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2">
                </div>
                <div class="md:col-span-2" id="options-container">
                    <label class="block text-sm font-medium text-gray-700">Options (Comma separated)</label>
                    <input type="text" id="options" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="e.g. Red, Blue, Green for Ink OR 1mm, 2mm for Qalam">
                    <p class="text-xs text-gray-500 mt-1">Leave empty to use default lists for Qalam/Ink. Enter values for others.</p>
                </div>
                <div class="md:col-span-2" id="description-container">
                    <label class="block text-sm font-medium text-gray-700">Description / Kit Contents</label>
                    <textarea id="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="Enter product description or kit contents..."></textarea>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Product Images <span id="image-count" class="text-gray-500 font-normal">(0/10)</span></label>
                <div class="mt-1">
                    <div class="flex gap-2">
                        <input type="url" id="image-url-input" class="block w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="Paste image URL here...">
                        <button type="button" onclick="addImageUrl()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 font-medium">Add</button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Enter URL and click Add (Max 10 images)</p>
                </div>
                <div id="image-preview-container" class="mt-2 hidden grid grid-cols-3 sm:grid-cols-4 gap-4">
                    <!-- Images injected here -->
                </div>
            </div>

            <div class="flex gap-4">
                <button type="submit" id="submit-btn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 font-medium">Save Product</button>
                <button type="button" onclick="resetForm()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 font-medium">Cancel</button>
            </div>
        </form>

        <!-- Product List -->
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Options</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="product-list" class="bg-white divide-y divide-gray-200">
                    <!-- Items injected here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'calligraphy_products_v4';
        let products = JSON.parse(localStorage.getItem(STORAGE_KEY));

        // Ensure ID 7 and 8 exist in Admin too (Migration for existing users)
        if (products && products.length > 0) {
            const newItems = [
                {
                    id: 7,
                    title: "Copperplate Oblique Holder",
                    tag: "Qalam",
                    price: 550,
                    mrp: 750,
                    image: "https://via.placeholder.com/400?text=Oblique+Holder",
                    options: ['Standard']
                },
                {
                    id: 8,
                    title: "Premium Gold Calligraphy Ink",
                    tag: "Ink",
                    price: 199,
                    mrp: 299,
                    image: "https://via.placeholder.com/400?text=Gold+Ink",
                    options: ['Gold']
                },
                {
                    id: 9,
                    title: "Calligraphy Practice Pad (A4)",
                    tag: "Paper",
                    price: 150,
                    mrp: 200,
                    image: "https://via.placeholder.com/400?text=Practice+Pad",
                    options: ['Grid', 'Lined', 'Blank']
                }
            ];
            let updated = false;
            newItems.forEach(item => {
                if (!products.find(p => p.id === item.id)) {
                    products.push(item);
                    updated = true;
                }
            });
            if (updated) localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
        }

        if (!products || products.length === 0) {
            products = [
                {
                    id: 1,
                    title: "Bamboo Qalam Set (7 Pens)",
                    tag: "Qalam",
                    price: 450,
                    mrp: 600,
                    image: "https://via.placeholder.com/400?text=Bamboo+Qalam",
                    options: ['Mix Set']
                },
                {
                    id: 2,
                    title: "Calligraphy Ink - Black 30ml",
                    tag: "Ink",
                    price: 120,
                    mrp: 150,
                    image: "https://via.placeholder.com/400?text=Black+Ink",
                    options: ['Black']
                },
                {
                    id: 3,
                    title: "Glossy Art Paper A4",
                    tag: "Paper",
                    price: 250,
                    mrp: 350,
                    image: "https://via.placeholder.com/400?text=Art+Paper",
                    options: []
                },
                {
                    id: 4,
                    title: "Glass Inkwell Container",
                    tag: "Ink container",
                    price: 80,
                    mrp: 120,
                    image: "https://via.placeholder.com/400?text=Inkwell",
                    options: []
                },
                {
                    id: 5,
                    title: "Beginner Calligraphy Kit",
                    tag: "Calligraphy Kit",
                    price: 999,
                    mrp: 1499,
                    image: "https://via.placeholder.com/400?text=Starter+Kit",
                    options: [],
                    description: "Complete set for beginners."
                },
                {
                    id: 6,
                    title: "Handmade Teak Qalam",
                    tag: "Qalam",
                    price: 300,
                    mrp: 450,
                    image: "https://via.placeholder.com/400?text=Teak+Qalam",
                    options: ['3mm', '5mm']
                },
                {
                    id: 7,
                    title: "Copperplate Oblique Holder",
                    tag: "Qalam",
                    price: 550,
                    mrp: 750,
                    image: "https://via.placeholder.com/400?text=Oblique+Holder",
                    options: ['Standard']
                },
                {
                    id: 8,
                    title: "Premium Gold Calligraphy Ink",
                    tag: "Ink",
                    price: 199,
                    mrp: 299,
                    image: "https://via.placeholder.com/400?text=Gold+Ink",
                    options: ['Gold']
                },
                {
                    id: 9,
                    title: "Calligraphy Practice Pad (A4)",
                    tag: "Paper",
                    price: 150,
                    mrp: 200,
                    image: "https://via.placeholder.com/400?text=Practice+Pad",
                    options: ['Grid', 'Lined', 'Blank']
                }
            ];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
        }

        const form = document.getElementById('product-form');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const productList = document.getElementById('product-list');

        let currentImages = [];

        function renderList() {
            productList.innerHTML = products.map(p => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap"><img src="${p.image || 'https://via.placeholder.com/50?text=No+Img'}" class="h-12 w-12 object-contain rounded border bg-gray-50"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${p.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${p.tag}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate" title="${p.options ? p.options.join(', ') : ''}">${p.options && p.options.length ? p.options.join(', ') : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${p.price}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editProduct(${p.id})" class="bg-indigo-100 text-indigo-700 hover:bg-indigo-200 px-3 py-1 rounded mr-2 transition"><i class="fas fa-edit mr-1"></i>Edit</button>
                        <button onclick="deleteProduct(${p.id})" class="bg-red-100 text-red-700 hover:bg-red-200 px-3 py-1 rounded transition"><i class="fas fa-trash mr-1"></i>Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function addImageUrl() {
            const input = document.getElementById('image-url-input');
            const url = input.value.trim();
            
            if (!url) return;
            
            if (currentImages.length >= 10) {
                alert("You can only upload a maximum of 10 images.");
                return;
            }

            currentImages.push(url);
            renderImagePreviews();
            input.value = '';
        }

        function renderImagePreviews() {
            imagePreviewContainer.innerHTML = '';
            document.getElementById('image-count').innerText = `(${currentImages.length}/10)`;
            if (currentImages.length > 0) {
                imagePreviewContainer.classList.remove('hidden');
                currentImages.forEach((img, index) => {
                    const div = document.createElement('div');
                    div.className = 'relative group';
                    div.innerHTML = `
                        <img src="${img}" class="h-24 w-full object-cover rounded border bg-gray-50">
                        <button type="button" onclick="removeImage(${index})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition shadow-sm">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    `;
                    imagePreviewContainer.appendChild(div);
                });
            } else {
                imagePreviewContainer.classList.add('hidden');
            }
        }

        function removeImage(index) {
            currentImages.splice(index, 1);
            renderImagePreviews();
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('product-id').value;
            const optionsStr = document.getElementById('options').value;

            const productData = {
                title: document.getElementById('title').value,
                tag: document.getElementById('tag').value,
                price: Number(document.getElementById('price').value),
                mrp: Number(document.getElementById('mrp').value),
                options: optionsStr ? optionsStr.split(',').map(s => s.trim()).filter(s => s) : [],
                description: document.getElementById('description').value,
                images: currentImages,
                image: currentImages.length > 0 ? currentImages[0] : ''
            };

            if (id) {
                const index = products.findIndex(p => p.id == id);
                if (index !== -1) products[index] = { ...products[index], ...productData };
            } else {
                products.push({ ...productData, id: Date.now(), modalType: 'none' });
            }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
            renderList();
            resetForm();
        });

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            document.getElementById('product-id').value = product.id;
            document.getElementById('title').value = product.title;
            document.getElementById('tag').value = product.tag;
            document.getElementById('price').value = product.price;
            document.getElementById('mrp').value = product.mrp;
            document.getElementById('options').value = product.options ? product.options.join(', ') : '';
            document.getElementById('description').value = product.description || '';
            currentImages = product.images || (product.image ? [product.image] : []);
            renderImagePreviews();

            const btn = document.getElementById('submit-btn');
            btn.innerText = "Update Product";
            btn.className = "bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-medium";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteProduct(id) {
            if(confirm('Delete this product?')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
                renderList();
            }
        }

        function resetForm() {
            form.reset();
            document.getElementById('product-id').value = '';
            document.getElementById('options').value = '';
            document.getElementById('description').value = '';
            document.getElementById('image-url-input').value = '';
            currentImages = [];
            renderImagePreviews();

            const btn = document.getElementById('submit-btn');
            btn.innerText = "Save Product";
            btn.className = "bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 font-medium";
        }

        function downloadJSON() {
            const dataStr = JSON.stringify(products, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", url);
            downloadAnchorNode.setAttribute("download", "products.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            URL.revokeObjectURL(url);
        }

        renderList();
    </script>
</body>
</html>
